# 功能操作说明

本文档汇总了系统各模块的操作步骤，便于教师、学生与管理员快速上手。默认初始密码为 `12345678`（首次登录后请及时修改）。

## 登录与账号
- 访问 `/accounts/login/` 选择“学生/教师登录”，或访问 `/admin/` 进入 Django Admin。
- 初始账号密码：教师/学生账号默认为 `12345678`，管理员账号为 `admin/admin123`（可在后台自行修改）。
- 首次登录后系统会提示非管理员用户修改密码；忘记密码时可由管理员在后台重置。

## 管理员常用操作
- **用户与安全**：在 Admin 中的“用户”列表可创建/编辑账号；保存时将自动补全默认密码并创建“账号安全设置”记录。
- **院系/课程/先修课**：在对应模型页面添加或维护院系、课程与先修关系；课程类型与先修成绩会自动校验。
- **主键/唯一约束检查**：
  - 学生的“学号”字段为必填且唯一，保存时自动生成（格式：年份+院系编号+三位序号）。如需手工录入，必须保证唯一。
  - 教师账号一对一绑定 `User`；院系字段受保护，若需调整院系需通过管理员在后台修改。
  - 课程代码唯一，教学班在同一学期同一课程下的 `section_code` 组合唯一；重复将被数据库拒绝。
- **教学班与上课时间**：在“教学班”详情页内联添加“上课时间”，需要保证结束时间晚于开始时间。
- **选课记录与审批**：在“选课记录”里查看学生选课状态，必要时修改状态或添加审批备注。
- **容量/时间/先修豁免**：当容量满、时间冲突或先修不达标时，可在“审批日志/学生申请”里审批通过并自动记录原因，或在“容量豁免”表中单独登记。

## 教师门户
- 登录后进入“教师工作台”，可查看本人教学班列表、容量与成绩填报锁定状态。
- 进入某教学班可录入或更新学生成绩；当“成绩填报锁定”开启时将阻止修改。
- 在“审批队列”页面处理学生的重修、跨院选课等审批请求，并留下审批意见。

## 学生门户
- 登录后在“学生仪表盘”查看本学期课表、成绩概览与待处理申请。
- 通过“选课/退课”入口提交或撤销选课申请；系统会依据先修课、容量与时间冲突自动提示。
- 若需重修或跨院选课，可发起审批请求并在“审批进度”中跟踪状态。

## 数据初始化与演示
- 运行 `python manage.py migrate` 进行数据库迁移后，可执行 `python manage.py bootstrap_demo` 一键生成演示院系、课程、教学班和用户数据（含默认密码）。
- CLI 模式可继续使用 `python app.py init-db` 初始化 SQLite 表结构，再通过 `python app.py transcript <username>` 等命令演示成绩单、先修校验和时间冲突检测。
- 常用 CLI 检查命令（均基于 `app.py` 的演示数据库）：
  - `python app.py transcript alice`：查看成绩单与 GPA。
  - `python app.py prereq alice CSE200`：检查先修课是否满足。
  - `python app.py conflict alice 2`：检测申请教学班是否与已选课表冲突。
  - `python app.py credit-load alice 2025FALL`：验证学分是否在 10–40 之间。
  - `python app.py capacity 2`：查看教学班容量与已占用席位。
  - `python app.py pass-rate 2025FALL` / `python app.py gpa-distribution 2025FALL`：查看通过率与绩点分布。
- SQL 查询脚本位于 `sql/queries.sql`，可在任意支持的数据库中直接运行以验证时间冲突、先修、学分上限/下限、通过率与绩点分布等业务规则。

## 数据一致性排查清单
- 学号、课程代码、教学班组合等唯一字段如保存失败，请检查是否存在重复记录或手工录入空值。
- 教师排课时间冲突会在保存“上课时间”时提示；如需豁免必须经管理员审批并通过审批日志记录。
- 低于 10 学分或超过 40 学分的课表构建会被拒绝；可通过“超学分申请”提交审批后再执行选课。
- 重修申请与跨院申请必须先在“学生申请”中提交并获批后，系统才允许重复或跨院选课。

## 密码与安全策略
- 创建用户但未填写密码时，系统会自动设置默认密码 `12345678` 并标记为“首次登录需修改密码”。
- 管理员可在“账号安全设置”中查看/更新用户的强制改密标记，确保账户安全。
